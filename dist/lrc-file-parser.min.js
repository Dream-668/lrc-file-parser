/**!
* lrc-file-parser.js v2.4.2
* Homepage: https://github.com/Dream-668/lrc-file-parser#readme
* License: MIT
*/
var Lyric=function(){"use strict";function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function e(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?t(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,u(n.key),n)}}function r(t,e,i){return(e=u(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function l(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=s(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){l=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(l)throw a}}}}function u(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var c=/^(?:\[[\d:.]+\])+/g,h=/\d{1,3}(:\d{1,3}){0,2}(?:\.\d{1,3})/g,f={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"},y="object"==("undefined"==typeof performance?"undefined":i(performance))&&performance.now?performance.now.bind(performance):Date.now.bind(Date),m=function(){},d={invokeTime:0,animationFrameId:null,timeoutId:null,callback:null,thresholdTime:200,run:function(){var t=this;this.animationFrameId=window.requestAnimationFrame((function(){t.animationFrameId=null;var e=t.invokeTime-y();if(e>0)return e<t.thresholdTime?void t.run():t.timeoutId=setTimeout((function(){t.timeoutId=null,t.run()}),e-t.thresholdTime);t.callback(e)}))},start:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.callback=t,this.invokeTime=y()+e,this.run()},clear:function(){this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),this.callback=null}},v=/^0+(\d+)/,p=/:0+(\d+)/g,b=/\.0+(\d+)/,g=function(t){return t.replace(v,"$1").replace(p,":$1").replace(b,".$1")},L=function(t,e){for(var i=e.split(/\r\n|\n|\r/),n=0;n<i.length;n++){var r=i[n].trim(),a=c.exec(r);if(a){var s=a[0],o=r.replace(c,"").trim();if(o){var u=s.match(h);if(null==u)continue;var f,y=l(u);try{for(y.s();!(f=y.n()).done;){var m=f.value,d=t[g(m)];d&&d.extendedLyrics.push(o)}}catch(t){y.e(t)}finally{y.f()}}}}},x=/<(\d+),(\d+)>/g,_=/(?=<\d+,\d+>)/g,w=function(t){var e,i=[],n="",r=l(t.split(_));try{for(r.s();!(e=r.n()).done;){var a=e.value,s=x.exec(a);if(s){var o=parseInt(s[1],10),u=parseInt(s[2],10),c=a.replace(x,"");c&&(i.push({text:c,start:o,duration:u}),n+=c)}else n+=a;x.lastIndex=0}}catch(t){r.e(t)}finally{r.f()}return{words:i,pureText:n}},k={title:"",artist:"",album:"",offset:0,by:""},P=function(){function t(i){var n=i.lyric,a=void 0===n?"":n,s=i.lxlyric,o=void 0===s?"":s,l=i.extendedLyrics,u=void 0===l?[]:l,c=i.offset,h=void 0===c?150:c,f=i.playbackRate,y=void 0===f?1:f,d=i.onPlay,v=void 0===d?m:d,p=i.onSetLyric,b=void 0===p?m:p,g=i.isRemoveBlankLine,L=void 0===g||g;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"lyric",void 0),r(this,"lxlyric",void 0),r(this,"extendedLyrics",void 0),r(this,"tags",void 0),r(this,"lines",void 0),r(this,"onPlay",void 0),r(this,"onSetLyric",void 0),r(this,"isPlay",void 0),r(this,"curLineNum",void 0),r(this,"maxLine",void 0),r(this,"offset",void 0),r(this,"isRemoveBlankLine",void 0),r(this,"_playbackRate",void 0),r(this,"_performanceTime",void 0),r(this,"_startTime",void 0),this.lyric=a,this.lxlyric=o,this.extendedLyrics=u,this.tags=e({},k),this.lines=[],this.onPlay=v,this.onSetLyric=b,this.isPlay=!1,this.curLineNum=0,this.maxLine=0,this.offset=h,this.isRemoveBlankLine=L,this._playbackRate=y,this._performanceTime=0,this._startTime=0,this._init()}var i,s,o;return i=t,s=[{key:"_init",value:function(){null==this.lyric&&(this.lyric=""),null==this.lxlyric&&(this.lxlyric=""),null==this.extendedLyrics&&(this.extendedLyrics=[]),this._initTag(),this._initLines(),this.onSetLyric(this.lines)}},{key:"_initTag",value:function(){this.tags=e({},k);for(var t=0,i=Object.keys(k);t<i.length;t++){var n=i[t],r=this.lyric.match(new RegExp("\\[".concat(f[n],":([^\\]]*)]"),"i"));r&&(this.tags[n]=r[1])}if(this.tags.offset){var a=parseInt(this.tags.offset);this.tags.offset=Number.isNaN(a)?0:a}else this.tags.offset=0}},{key:"_initLines",value:function(){this.lines=[];for(var t=this.lyric.split(/\r\n|\n|\r/),e={},i=t.length,n=0;n<i;n++){var r=t[n].trim(),s=c.exec(r);if(s){var o=s[0],u=r.replace(c,"").trim();if(u||!this.isRemoveBlankLine){var f=o.match(h);if(null==f)continue;var y,m=l(f);try{for(m.s();!(y=m.n()).done;){var d=y.value,v=g(d);if(e[v])e[v].extendedLyrics.push(u);else{var p=v.split(":");if(!(p.length>3)){if(p.length<3)for(var b=3-p.length;b--;)p.unshift("0");p[2].includes(".")&&p.splice.apply(p,[2,1].concat(a(p[2].split(".")))),e[v]={time:60*parseInt(p[0])*60*1e3+60*parseInt(p[1])*1e3+1e3*parseInt(p[2])+parseInt(p[3]||"0"),text:u,words:[],extendedLyrics:[]}}}}}catch(t){m.e(t)}finally{m.f()}}}}if(this.lxlyric)for(var x=this.lxlyric.split(/\r\n|\n|\r/),_=0;_<x.length;_++){var k=x[_].trim(),P=c.exec(k);if(P){var T=P[0],N=k.replace(c,"").trim();if(N){var I=T.match(h);if(null==I)continue;var O,j=l(I);try{for(j.s();!(O=j.n()).done;){var S=O.value,R=e[g(S)];if(R){var A=w(N),F=A.words,C=A.pureText;R.words=F,R.text=C}}}catch(t){j.e(t)}finally{j.f()}}}}var E,D=l(this.extendedLyrics);try{for(D.s();!(E=D.n()).done;){var B=E.value;L(e,B)}}catch(t){D.e(t)}finally{D.f()}this.lines=Object.values(e),this.lines.sort((function(t,e){return t.time-e.time})),this.maxLine=this.lines.length-1}},{key:"_currentTime",value:function(){return(y()-this._performanceTime)*this._playbackRate+this._startTime}},{key:"_findCurLineNum",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)return 0;for(var i=this.lines.length,n=e;n<i;n++)if(t<=this.lines[n].time)return 0===n?0:n-1;return i-1}},{key:"_handleMaxLine",value:function(){this.onPlay(this.curLineNum,this.lines[this.curLineNum].text),this.pause()}},{key:"_refresh",value:function(){var t=this;if(this.curLineNum++,this.curLineNum>=this.maxLine)this._handleMaxLine();else{var e=this.lines[this.curLineNum],i=this._currentTime(),n=i-e.time;if(n>=0||0===this.curLineNum){var r=(this.lines[this.curLineNum+1].time-e.time-n)/this._playbackRate;if(r>0)this.isPlay&&d.start((function(){t.isPlay&&t._refresh()}),r),this.onPlay(this.curLineNum,e.text);else{var a=this._findCurLineNum(i,this.curLineNum+1);a>this.curLineNum&&(this.curLineNum=a-1),this._refresh()}}else this.curLineNum=this._findCurLineNum(i,this.curLineNum)-1,this._refresh()}}},{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.lines.length&&(this.pause(),this.isPlay=!0,this._performanceTime=y()-Math.trunc(this.tags.offset+this.offset),this._startTime=t,this.curLineNum=this._findCurLineNum(this._currentTime())-1,this._refresh())}},{key:"pause",value:function(){if(this.isPlay&&(this.isPlay=!1,d.clear(),this.curLineNum!==this.maxLine)){var t=this._findCurLineNum(this._currentTime());this.curLineNum!==t&&(this.curLineNum=t,this.onPlay(t,this.lines[t].text))}}},{key:"setPlaybackRate",value:function(t){this._playbackRate=t,this.lines.length&&this.isPlay&&this.play(this._currentTime())}},{key:"setLyric",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.isPlay&&this.pause(),this.lyric=t,this.lxlyric=e,this.extendedLyrics=i,this._init()}}],s&&n(i.prototype,s),o&&n(i,o),Object.defineProperty(i,"prototype",{writable:!1}),t}();return P}();
